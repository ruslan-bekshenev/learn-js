# WeakMap и WeakSet

`WeakMap` - предотвращает удаление объектов сборщиком мусора, когда эти объекты выступают в качестве ключей.

## WeakMap

Первое отличие от `Map` - ключи должны быть объектами, а не примитивными значениями.
Если объект используется в качестве ключа и на этот объект нет больше ссылок, то он будет удален и памяти (и из WeakMap) автоматически.

`WeakMap` не поддерживает перебор и методы `keys()`, `values()`, `entries()`,

Доступные методы:

- `weakMap.get(key)`
- `weakMap.set(key, value)`
- `weakMap.delete(key)`
- `weakMap.has(key)`

К чему такие ограничения?

Если объект станет недостижимым, то он будет удален из сборщика мусора. Но нет информации в какой момент это произойдет.

Решение о том, когда делать сборку мусора, принимает движок JS. Так что технически количество элементов в коллекции `WeakMap` неизвестно.

Движок может произвести очистку сразу или потом, или сделать это частично. По этой причине методы для доступа ко всем сразу ключам/значениям недоступны

## WeakSet

- Аналогична `Set`, но добавлять можно только объекты
- Объект присутствует в множестве только до тех пор, пока доступен где-то еще.
- Как и `Set`, поддерживает `add`, `has`, `delete`, но не `size`, `keys()` и не является перебираемым

Служит в качестве дополнительного хранилища. Но не для произвольных данных, а скорее для значений типа "да/нет"

## Итого

`WeakMap` – это `Map`-подобная коллекция, позволяющая использовать в качестве ключей только объекты, и автоматически удаляющая их вместе с соответствующими значениями, как только они становятся недостижимыми иными путями.

`WeakSet` – это `Set`-подобная коллекция, которая хранит только объекты и удаляет их, как только они становятся недостижимыми иными путями.

Обе этих структуры данных не поддерживают методы и свойства, работающие со всем содержимым сразу или возвращающие информацию о размере коллекции. Возможны только операции на отдельном элементе коллекции.

`WeakMap` и `WeakSet` используются как вспомогательные структуры данных в дополнение к «основному» месту хранения объекта. Если объект удаляется из основного хранилища и нигде не используется, кроме как в качестве ключа в WeakMap или в WeakSet, то он будет удалён автоматически.