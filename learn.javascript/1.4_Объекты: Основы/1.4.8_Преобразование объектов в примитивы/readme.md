# Преобразование объектов в примитивы

Если применить математическую операцию двух объектов, то в первую очередь они автоматически преобразуются в примитивы, а затем выполнится операция.

1. Все объекты в логическом контексте являются **true**. Существуют лишь их численные и строковые преобразования
2. Численные преобразования происходят, когда мы вычитаем объекты или выполняем математические операции.
3. Что касается строковых преобразований - они обычно происходят, когда мы выводим объект **alert(obj)**, а также в других случаях, когда объект используется как строка.

## Преобразования к примитивам

Существуют 3 вида преобразований:

- "string"
  - Преобразование объекта к строке **alert(obj)**
- "number"
  - Number(obj) - явное преобразование
  - Унарный плюс
  - Вычитание
  - сравнение больше либо менье
- "default"
  - Происходит когда оператор не уверен, какой тип ожидать, например бинарный + 
  - Оператор больше/меньше <> также может работать как со строками, так и с числами. Однако, по историческим причинам он использует хинт «number», а не «default».
  - На правктике все встроенные объекты, исключая Date, реализуют "default" преобразования тем же способом, что и "number"


### В процессе преобразования движок JavaScript пытается найти и вызвать три следующих метода объекта:

1. Вызывает  obj[Symbol.toPrimitive](hint) - метод с символьным ключом Symbol.toPrimitive(системный символ), если такой метод существует, и передает ему хинт.
2. Иначе, если хинт равен "string"
3. В случае, если хинт равен "number" или "default". Пытается вызвать obj.valueOf(), а если его нет, то obj.toString(), если он существует

## Symbol.toPrimitive

```
  obj[Symbol.toPrimitive] = function(hint) {
    // должен вернуть примитивное значение
    // hint равно чему-то одному из: "string", "number" или "default"
  };
  
  let user = {
    name: "John",
    money: 1000,
  
    [Symbol.toPrimitive](hint) {
      alert(`hint: ${hint}`);
      return hint == "string" ? `{name: "${this.name}"}` : this.money;
    }
  };
  
  // демонстрация результатов преобразований:
  alert(user); // hint: string -> {name: "John"}
  alert(+user); // hint: number -> 1000
  alert(user + 500); // hint: default -> 1500
```

## Методы toString/valueOf

Устаревший способ реализации преобразования объектов

Если нет метода Symbol.toPrimitive, движок JS пытается найти эти методы и вызвать их следующим образов:
- toString -> valueOf для хинта со значением "string"
- valueOf -> toString - в ином случае

```
  let user = {
    name: "John",
    money: 1000,
  
    // для хинта равного "string"
    toString() {
      return `{name: "${this.name}"}`;
    },
  
    // для хинта равного "number" или "default"
    valueOf() {
      return this.money;
    }
  
  };
  
  alert(user); // toString -> {name: "John"}
  alert(+user); // valueOf -> 1000
  alert(user + 500); // valueOf -> 1500
```

В отсутствие Symbol.toPrimitive и valueOf, toString обработает все случаи преобразований к примитивам.


## Возвращаемые типы

Все описанные методы для преобразования объектов не обязаны возвращать именно требуемый "хинтом" тип примитива.

### Единственное обязательное требование: методы должны возвращать примитив, а не объект.

По историческим причинам, если toString или valueOf вернёт объект, то ошибки не будет, но такое значение будет проигнорировано (как если бы метода вообще не существовало).

Метод Symbol.toPrimitive, напротив, обязан возвращать примитив, иначе будет ошибка.

## Последующие операции

После преобразования операция получает примити и затем продолжает работу с ним, производя дальнейшие преобразования, если это необходимо.

- Математически операции, исключая бинарный плюс, преобразуют примитив к числу
- Бинарный плюс в аналогичном случаем сложит строки.