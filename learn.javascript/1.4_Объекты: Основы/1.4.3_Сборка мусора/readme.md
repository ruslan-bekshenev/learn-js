# Сборка мусора

Управление памятью в JS выполняется автоматически и незаметно

## Достижимость

Основной концепцией управления памяться в JS является принцип **достижимости**.

Вкратце, достижимые значения - это те, которые доступны или используются. Они гарантировано находятся в памяти.

1. Существует базовое множество достижимых значений, которые не могут быть удалены.

- Локальные переменные и параметры текущей функции.
- Переменные и параметры других функций в текущей цепочке вложенных вызовов.
- Глобальные переменные 
- Некоторые другие внутренние значения.

Эти значения мы будем называть корнями.

2. Любое другое значение считаеется достижимым, если оно доступно из корня по ссылке или по цепочке ссылок.

Например, если в локальной переменной есть объект, и он имеет свойство, в котором хранится ссылка на другой объект, то этот объект считается достижимым. И те, на которые он ссылается, тоже достижимы.

## Внутренние алгоритмы

Основной алгоритм сборки мусора - "алгоритм пометок"

Сборщик мусора выполняет следующие шаги:

1. Сборщик мусора "помечает" все корневые объекты.
2. Затем он идет по их ссылкам и помечает все найденные объекты.
3. Все объекты запоминаются, чтобы в будущем не посещать один и тот же объект дважды.
4. …И так далее, пока не будут посещены все ссылки (достижимые от корней).
5. Все непомеченные объекты удаляются.

Интерпретаторы JavaScript применяют множество оптимизаций, чтобы сборка мусора работала быстрее и не влияла на производительность.

Примеры оптимизаций:

- Сборка по поколениям (Generational collection) - объекты делятся на новые и старые. Многие объекты появляются, выполняют свою задачу и быстро умирают, их можно удалять более агрессивно. Те, которые живут достаточно долго, становятся «старыми» и проверяются реже.

- Инкрементальная сборка (Incremental collection) - если объектов много, то обход всех ссылкох и пометка достижимых объектов займет время, поэтому интепретатор организовывает сборку мусора поэтапно. Этапы выполняются отдельно один за других.

- Сборка в свободное время (Idle-time collection) - сборщик мусора старается работать только во время простоя процессора, чтобы уменьшить нагрузку на производительность.

Существуют и другие способы оптимизации и разновидности алгоритмов сборки мусора.