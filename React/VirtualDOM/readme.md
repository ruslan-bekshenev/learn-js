# Что такое Virtual DOM?

## Что такое DOM?

**DOM (Document Object Model)** - способ представления структурного документа с помощью объектов.
Веб-браузеры обрабатывают составляющие DOM, и мы можем взаимодействовать с ними, используя JavaScript и CSS.
Можем работать с узлами документа, удалять, изменять данные,  вставлять новые узлы.

### Проблема DOM

**DOM** никогда не был рассчитан для создания динамического пользовательго интерфейса. Для примера, операция по смещению 1000 div-блоков
может занять больше секунды - это слишком много для современного интернета.


## Shadow DOM

Спецификация описывающая метод объединения нескольких DOM-деревьев в одну иерархию и как эти деревья взаимодействовать друг с другом в пределах документа, что позволяет лучше скомпоновать DOM.

Используется для инкапсуляции. Благодаря ему в компоненте есть собственное "теневое" DOM-дерево, к которому нельзя просто так обратиться из главного документа, у него могут быть изолированные CSS-правила.

Теневой DOM - это способ создать свой, изолированный, DOM для компонента.

### Встроенный теневой DOM

Как браузер рисует сложные браузерные элементы управления?

Браузер рисует их своими силами и по своему усмотрению. Их DOM-структура обычно нам не видна, но через инструменты разработчика можно ее посмотреть.
К примеру, в Chrome для этого нужно активировать пункт "Show user agent shadow DOM".

То, что находится под `#shadow-root` - и называется "shadow DOM"

Чтобы изменить стили нужно использовать атрибут `pseudo`.

```
<style>
/* делаем цвет шкалы ползунка красным */
input::-webkit-slider-runnable-track {
  background: red;
}
</style>

<input type="range">
```

### Теневое дерево

Каждый DOM-элемент может иметь 2 типа поддеревьев DOM:

1. Light tree - обычное DOM-поддерево, состоящее из HTML-потомков.
2. Shadow tree - скрытое, "теневое", DOM-поддерево, не отраженное в HTML, скрытое от посторонних глаз.

Если у элемента имеются оба поддерева, браузер отрисовывает только теневое дерево.

Теневое дерево можно использовать в пользовательских элементах, чтобы спрятать внутренности компонента и применить к ним локальные стили. 

**Ограничения:**

- Для каждого элемента можем создать только один shadow root.
- В качестве elem может быть использован пользовательский элемент (Custom Element), либо один из следующих элементов: «article», «aside», «blockquote», «body», «div», «footer», «h1…h6», «header», «main», «nav», «p», «section» или «span». Остальные, например, <img>, не могут содержать теневое дерево.

### Инкапсуляция

Элементы теневого DOM не видны из обычного DOM через `querySelector`.
У теневого DOM свои стили.